<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>

body{
font-family:Segoe UI;
margin:0;
background:transparent;
}

.container{
max-width:520px;
margin:auto;
padding:15px;
}

.botao{
padding:6px 10px;
margin:4px;
border-radius:6px;
border:none;
cursor:pointer;
background:#27ae60;
color:white;
font-weight:bold;
}

input{
padding:6px;
margin-top:5px;
}

.semana{
margin-top:15px;
padding:10px;
border-radius:8px;
background:#f8f9fa;
}

.dia{
padding:6px;
margin:3px 0;
border-left:4px solid transparent;
}

.hoje{
border-left:6px solid #27ae60;
font-weight:bold;
background:#ffffff;
}

</style>
</head>

<body>

<div class="container">

<div id="dataTexto"></div>

<button class="botao" onclick="voltarHoje()">üìÖ HOJE</button>

<br><br>

<input type="date" id="dataEscolhida">
<button class="botao" onclick="aplicarData()">Aplicar</button>

<hr>

<div id="botoesTemporadas"></div>

<div id="conteudo"></div>

</div>

<script>

// ================= DATA =================

function getDataPlano(){
let salva = localStorage.getItem("dataPlano");
if(salva) return new Date(salva);
return new Date();
}

function aplicarData(){

const valor =
document.getElementById("dataEscolhida").value;

if(!valor) return;

localStorage.setItem("dataPlano",valor);
location.reload();
}

function voltarHoje(){
localStorage.removeItem("dataPlano");
location.reload();
}

const dataPlano=getDataPlano();

document.getElementById("dataTexto")
.innerHTML=
"Leitura do plano em: <b>"+
dataPlano.toLocaleDateString("pt-BR",
{weekday:"long",day:"2-digit",month:"long"})+
"</b>";

const chaveHoje=
String(dataPlano.getMonth()+1).padStart(2,"0")
+"-"+String(dataPlano.getDate()).padStart(2,"0");


// ================= CARREGAR JSON =================

let plano={};

fetch("leitura-biblica-perpetuo.json")
.then(r=>r.json())
.then(data=>{
plano=data;
criarBotoes();
mostrarTemporadasDisponiveis();
});


// ================= MOSTRAR TEMPORADAS DO DIA =================

function mostrarTemporadasDisponiveis(){

const area=document.getElementById("botoesTemporadas");
area.innerHTML="<b>‚≠ê Temporadas dispon√≠veis hoje:</b><br>";

Object.keys(plano).forEach(temp=>{

const existeSemana =
plano[temp].some(
sem=>Object.keys(sem.dias)
.includes(chaveHoje)
);

if(existeSemana){

area.innerHTML+=
`<button class="botao"
onclick="abrirTemporada('${temp}')">
üìñ ${temp.toUpperCase()}
</button>`;

}

});

}


// ================= ABRIR TEMPORADA =================

function abrirTemporada(temp){

const area=document.getElementById("conteudo");
area.innerHTML="";

plano[temp].forEach(sem=>{

if(Object.keys(sem.dias).includes(chaveHoje)){

let html=
`<div class="semana">
<h3>üìñ ${sem.semana}</h3>`;

for(const data in sem.dias){

const destaque=
data===chaveHoje
? "dia hoje"
: "dia";

html+=
`<div class="${destaque}">
${data===chaveHoje?"üìñ ":""}
${data.replace("-","/")} ‚Äî ${sem.dias[data]}
</div>`;
}

html+=
`<p><b>Vers√≠culo:</b> ${sem.versiculo}</p>
</div>`;

area.innerHTML+=html;

}

});

}

</script>

</body>
</html>