<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>

body{
font-family:Segoe UI;
margin:0;
background:transparent;
}

.container{
max-width:520px;
margin:auto;
padding:15px;
}

.botao{
padding:6px 10px;
margin:4px;
border-radius:6px;
border:none;
cursor:pointer;
background:#27ae60;
color:white;
font-weight:bold;
}

.semana{
margin-top:15px;
padding:10px;
border-radius:8px;
background:#f8f9fa;
}

.dia{
padding:6px;
margin:3px 0;
border-left:4px solid transparent;
}

.hoje{
border-left:6px solid #27ae60;
font-weight:bold;
background:white;
}

</style>
</head>

<body>

<div class="container">

<div id="dataTexto"></div>

<button class="botao" onclick="voltarHoje()">ðŸ“… HOJE</button>

<br><br>

<input type="date" id="dataEscolhida">
<button class="botao" onclick="aplicarData()">Aplicar</button>

<hr>

<div id="temporadas"></div>
<div id="conteudo"></div>

</div>

<script>

// ================= DATA =================

function getDataPlano(){
const salva=localStorage.getItem("dataPlano");
return salva?new Date(salva):new Date();
}

function aplicarData(){
const valor=document.getElementById("dataEscolhida").value;
if(!valor)return;
localStorage.setItem("dataPlano",valor);
location.reload();
}

function voltarHoje(){
localStorage.removeItem("dataPlano");
location.reload();
}

const dataPlano=getDataPlano();

document.getElementById("dataTexto").innerHTML=
"<b>"+
dataPlano.toLocaleDateString(
"pt-BR",
{weekday:"long",day:"2-digit",month:"long"}
)+"</b>";

const chaveHoje=
String(dataPlano.getMonth()+1).padStart(2,"0")
+"-"+String(dataPlano.getDate()).padStart(2,"0");


// ================= LOCALIZAR JSON =================

const jsonURL =
window.location.href
.replace("plano-leitura.html",
"leitura-biblica-perpetuo.json");


// ================= CARREGAR =================

fetch(jsonURL)
.then(r=>r.json())
.then(plano=>{

const areaTemp=document.getElementById("temporadas");

Object.keys(plano).forEach(temp=>{

const existe=
plano[temp].some(
s=>Object.keys(s.dias)
.includes(chaveHoje)
);

if(existe){

const btn=document.createElement("button");
btn.className="botao";
btn.innerText="ðŸ“– "+temp.toUpperCase();

btn.onclick=()=>{
abrir(temp,plano);
};

areaTemp.appendChild(btn);

}

});

});


function abrir(temp,plano){

const area=document.getElementById("conteudo");
area.innerHTML="";

plano[temp].forEach(sem=>{

if(!sem.dias[chaveHoje]) return;

let html=`<div class="semana">
<h3>${sem.semana}</h3>`;

for(const data in sem.dias){

html+=`
<div class="${
data===chaveHoje?"dia hoje":"dia"
}">
${data===chaveHoje?"ðŸ“– ":""}
${data.replace("-","/")} â€” ${sem.dias[data]}
</div>`;
}

html+=`<p><b>VersÃ­culo:</b> ${sem.versiculo}</p></div>`;

area.innerHTML+=html;

});

}

</script>

</body>
</html>