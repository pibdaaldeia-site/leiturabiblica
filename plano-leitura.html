<!DOCTYPE html>
<html lang="pt-br">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>

body{
font-family:Segoe UI;
margin:0;
background:transparent;
}

.container{
max-width:520px;
margin:auto;
padding:15px;
}

.botao{
padding:6px 10px;
margin:4px;
border-radius:6px;
border:none;
cursor:pointer;
background:#27ae60;
color:white;
font-weight:bold;
}

input{
padding:6px;
margin-top:5px;
}

.semana{
margin-top:15px;
padding:10px;
border-radius:8px;
background:#f8f9fa;
}

.dia{
padding:6px;
margin:3px 0;
border-left:4px solid transparent;
}

.hoje{
border-left:6px solid #27ae60;
font-weight:bold;
background:#ffffff;
}

</style>

</head>

<body>

<div class="container">

<div id="dataTexto"></div>

<button class="botao" onclick="voltarHoje()">‚≠ê HOJE</button>

<br><br>

<input type="date" id="dataEscolhida">
<button class="botao" onclick="aplicarData()">Aplicar</button>

<hr>

<div id="temporadas"></div>

<div id="conteudo"></div>

</div>

<script>

// ================= DATA =================

function getDataPlano(){
let salva=localStorage.getItem("dataPlano");
return salva ? new Date(salva) : new Date();
}

function aplicarData(){
const valor=document.getElementById("dataEscolhida").value;
if(!valor) return;
localStorage.setItem("dataPlano",valor);
location.reload();
}

function voltarHoje(){
localStorage.removeItem("dataPlano");
location.reload();
}

const dataPlano=getDataPlano();

document.getElementById("dataTexto").innerHTML=
"<b>üìñ Hoje no plano:</b> "+
dataPlano.toLocaleDateString("pt-BR",
{weekday:"long",day:"2-digit",month:"long"});

const chaveHoje=
String(dataPlano.getMonth()+1).padStart(2,"0")
+"-"+String(dataPlano.getDate()).padStart(2,"0");


// ================= CARREGAR JSON =================

fetch(
"https://pibdaaldeia-site.github.io/leiturabiblica/leitura-biblica-perpetuo.json?v="+Date.now()
)
.then(response=>{

if(!response.ok){
throw new Error("JSON n√£o encontrado");
}

return response.json();

})
.then(plano=>{

const areaTemp=document.getElementById("temporadas");
areaTemp.innerHTML="";

Object.keys(plano).forEach(temp=>{

const existe=plano[temp].some(
sem=>Object.keys(sem.dias).includes(chaveHoje)
);

if(existe){

const btn=document.createElement("button");
btn.className="botao";
btn.innerText="üìñ "+temp.toUpperCase();

btn.onclick=()=>{
abrir(temp,plano);
};

areaTemp.appendChild(btn);
}

});

// ‚≠ê abre automaticamente a temporada correta
const primeira=Object.keys(plano).find(t=>
plano[t].some(s=>s.dias[chaveHoje])
);

if(primeira){
abrir(primeira,plano);
}

})
.catch(err=>{
document.getElementById("conteudo")
.innerHTML="‚ö†Ô∏è Erro ao carregar plano.";
console.error("ERRO:",err);
});

}

</script>

</body>
</html>